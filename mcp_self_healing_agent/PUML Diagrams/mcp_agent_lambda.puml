@startuml MCPAgentLambdaE2E
title MCP Self-Healing Selenium Agent Lambda - End to End Flow


actor "Test Automation" as TestRunner
entity "MCP Agent Lambda" as Lambda
entity "Semantic Retriever (LangChain+OpenSearch)" as Retriever
entity "Bedrock LLM (LangChain)" as LLM
entity "Locator Extractor" as LocatorExtract

TestRunner --> Lambda : Send failure report (test_name, error, stack_trace, dom_snapshot)
Lambda --> Retriever : Retrieve past fixes (semantic search)
Retriever --> Lambda : Return relevant past fixes
Lambda --> LLM : Build prompt (with context), request fix suggestion
LLM --> Lambda : Return fix suggestion (Python code, locator, waits, etc.)
Lambda --> LocatorExtract : Extract new locator from suggestion
LocatorExtract --> Lambda : Return new locator
Lambda --> TestRunner : Return fix suggestion, new locator

note right of Lambda
- Receives failure report
- Retrieves past fixes using semantic search
- Builds prompt for LLM with context
- Gets suggestion from LLM
- Extracts locator if present
- Returns fix suggestion and locator
end note

@enduml